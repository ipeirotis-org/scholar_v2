<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ author.get('name', 'N/A') }} -- Age-normalized Google Scholar Analysis</title>
        <link rel="stylesheet"
              href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/font/bootstrap-icons.css">
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
    <body>
        <main id="results">
            <section>
                <h2>Author: {{ author.get('name', 'N/A') }}</h2>
                <div class="author-details">
                    <ul>
                        <li>Author Name: {{ author.get('name', 'N/A') }}</li>
                        <li>Current Affiliation: {{ author.get('affiliation', 'N/A') }}</li>
                        <li>Google Scholar ID: {{ author.get('scholar_id', 'N/A') }}</li>
                        <li>Last Modified: {{ author.get('last_modified', 'N/A') }} (<a id="refreshButton" data-author-id="{{ author.scholar_id }}">Refresh</a>)</li>
                        <li>
                            First Year Active: {{ author.stats.year_of_first_pub }} ({{ 2024 - author.stats.year_of_first_pub + 1 }} years active)
                        </li>
                        <li>
                            <span class="metrics-explanation" data-toggle="tooltip"
                              title="This is the number of citations to all publications; the percentile shows how the author ranks 
                                against other authors who started publishing in {{ author.stats.year_of_first_pub }}.">
                                Total Citations</span>: {{ author.stats.citedby }}
                            ({{ (100*author.stats.citedby_percentile)|round(2) }}% percentile)
                        </li>
                        <li><span class="metrics-explanation" data-toggle="tooltip" 
                                title="This is the number of new citations in the last 5 years to all publications; the percentile 
                                shows how the author ranks against other authors who started publishing in {{ author.stats.year_of_first_pub }}.">
                                Recent Citations (last 5 years)</span>: {{ author.stats.citedby5y }}
                            ({{ (100*author.stats.citedby5y_percentile)|round(2) }}% percentile)
                        </li>
                        <li><span class="metrics-explanation" data-toggle="tooltip" title="The h-index of the author is the largest 
                                number h such that h publications have at least h citations; the percentile shows how the author ranks 
                                against other authors who started publishing in {{ author.stats.year_of_first_pub }}.">
                                H-index</span>: {{ author.stats.hindex }}
                            ({{ (100*author.stats.hindex_percentile)|round(2) }}% percentile)
                        </li>
                        <li>
                            <span class="metrics-explanation" data-toggle="tooltip" title="The is the 'recent' version of the h-index, 
                                which is the largest number h such that h publications have at least h new citations in the last 5 years; 
                                the percentile shows how the author ranks against other authors who started publishing in {{ author.stats.year_of_first_pub }}.">
                                H-index (last 5 years)</span>: {{ author.stats.hindex5y }}
                            ({{ (100*author.stats.hindex5y_percentile)|round(2) }}% percentile)
                        </li>
                        <li><span class="metrics-explanation" data-toggle="tooltip" title="The total number of publications (with at least 
                                one citation) by the author, and their percentile rank compared to other authors who started 
                                publishing in {{ author.stats.year_of_first_pub }}.">
                            Total Publications</span>: {{ author.stats.total_publications_with_citations }}
                            ({{ (100*author.stats.total_publications_with_citations_percentile)|round(2) }}% percentile)
                        </li>
                        <li><span class="metrics-explanation" data-toggle="tooltip" title="i10-index is the number of publications with at 
                                least 10 citations; the percentile shows how the author ranks against other authors who started 
                                publishing in {{ author.stats.year_of_first_pub }}.">
                            i10-index</span>: {{ author.stats.i10index }}
                            ({{ (100*author.stats.i10index_percentile)|round(2) }}% percentile)
                        </li>
                        <li><span class="metrics-explanation" data-toggle="tooltip" title="The number of publications that have received 
                                at least 10 new citations in the last 5 years; the percentile shows how the author ranks against other 
                                authors who started publishing in {{ author.stats.year_of_first_pub }}.">
                            i10-index (last 5 years)</span>: {{ author.stats.i10index5y }}
                            ({{ (100*author.stats.i10index5y_percentile)|round(2) }}% percentile)
                        </li>
                        <li>
                            <strong><span class="metrics-explanation" data-toggle="tooltip" title="PiP-AUC Score represents the author's 
                                        impact and productivity, with its percentile indicating the rank compared to other authors who 
                                        started publishing in {{ author.stats.year_of_first_pub }}.">
                                PiP-AUC Score</span>: {{ author.stats.pip_auc_score }}
                                ({{ (100*author.stats.pip_auc_score_percentile)|round(2) }}% percentile)
                            </strong>
                        </li>
                            <a class="btn btn-info btn-sm" data-toggle="collapse" href="#pipAucExplanation" role="button" aria-expanded="false" aria-controls="pipAucExplanation">
                                Learn more about PiP-AUC Score
                            </a>
                            <div class="collapse" id="pipAucExplanation">
                                <p>
                                    The PiP-AUC score evaluates research impact and productivity by plotting papers' citation percentiles against all papers published in the same year on the y-axis, and the quantity of an author's work on the x-axis. The y-axis ranks papers from highest to lowest citation percentile. On the x-axis, the number of papers published is normalized to show an author's percentile against peers who started publishing in the same year. The maximum value on the x-axis represents the author's total number of publications. Moving backwards along the x-axis corresponds to sequentially removing the author's lowest percentile papers, which in turn, can increase the position on the y-axis if the removed papers are of lower citation percentile. This method calculates the area under the curve, capturing both the impact (citation percentile) and quantity (publication percentile) of a researcher's work. Each point on the curve reflects the balance between keeping all papers (maximum quantity) and the increased average impact when excluding lower-performing papers. The overall score, ranging from 0 to 1, combines these aspects to reflect a researcher's contributions.
                                </p>
                            </div>
                        
                    </ul>
                </div>
                {% for path in author.plot_paths %}<img class="plot" src="{{ path }}" alt="Generated Plot">{% endfor %}
                <center>
                    <a href="{{ url_for('download_results', author_id=author.get('scholar_id', 'N/A') ) }}">
                        Download CSV for {{ author.get('name', 'N/A') }}
                    </a>
                </center>
                <table id="resultsTable"
                       class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0, 'resultsTable')" class="sortable">Title</th>
                            <th onclick="sortTable(1, 'resultsTable', true)" class="sortable">Year of Publication</th>
                            <th onclick="sortTable(2, 'resultsTable', true)" class="sortable">Citations</th>
                            <th onclick="sortTable(3, 'resultsTable', true)" class="sortable">Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in author.publications %}
                            <tr>
                                <td>
                                    {{ item.title }}
                                    <br>
                                    <i>{{ item.citation }}</i>
                                    <br>
                                    <!-- Add link to publication details page -->
                                    <a href="{{ url_for('get_publication_details', author_id=author.get('scholar_id') , pub_id=item.author_pub_id) }}">View Details</a>
                                </td>
                                <td>{{ item.pub_year }}</td>
                                <td>{{ item.num_citations }}</td>
                                <td>{{ (100*item.num_citations_percentile)|round(2) }}%</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>
        </main>
        <footer>
            <p>
                <a href="https://github.com/ipeirotis-org/scholar_v2">Code</a>
                and <a href="https://arxiv.org/abs/2103.16025">Paper</a>.
                For any issues, please contact <a href="mailto:panos@nyu.edu">Panos Ipeirotis</a>.
            </p>
        </footer>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.bundle.min.js"
                defer></script>
        <script src="{{url_for('static', filename='tablesort.js')}}" defer></script>
        <script>
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip(); 
    });
        </script>

    <script>
    document.getElementById('refreshButton').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the default link behavior
        var authorId = this.getAttribute('data-author-id');
        var link = this; // Reference to the link
        link.textContent = 'Queuing...'; // Change link text to indicate processing
        link.style.pointerEvents = 'none'; // Prevent further clicks
    
        // Adjust the fetch call to use a GET request
        fetch(`/api/refresh_authors?scholar_ids=${authorId}`, {
            method: 'GET',
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data);
            link.textContent = 'Queued for Refresh'; // Update link text to show completion
        })
        .catch((error) => {
            console.error('Error:', error);
            link.textContent = 'Error'; // Optionally reset link or show error
            link.style.pointerEvents = 'auto'; // Re-enable clicking in case of error
        });
    });
    </script>

        
    </body>
</html>
